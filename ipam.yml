---
- name: Add IP to phpIPAM
  hosts: localhost
  gather_facts: no
  vars:
    ipam: 'sf1-ipam.telelink.bg'
    phpipam_api_url: "https://{{ ipam }}/api/ansible"  # Update with your API URL
    phpipam_token: "lUyiiSJbFvUlahuIVfmJp0kmHKjehLAf"              # Replace with your API token

  tasks:
    - name: Add IP address to phpIPAM
      uri:
        url: "{{ phpipam_api_url }}/addresses/"
        method: POST
        headers:
          Content-Type: "application/json"
          token: "{{ phpipam_token }}"
        body: |
          {
            "ip": "{{ variable_ip }}",
            "hostname": "{{ variable_host }}"
          }
        body_format: json
        return_content: yes
      register: result

    - name: Display response
      debug:
        var: result.json
